<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <title>Projections Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' }
  </script>
</head>

<body class="bg-slate-950 text-slate-100">

<div class="aurora-bg" aria-hidden="true"></div>
<div class="aurora-noise" aria-hidden="true"></div>

<!-- Blur-only transition overlay (no color change, no ripple) -->
<div id="transitionOverlay" class="transition-overlay hidden" aria-hidden="true"></div>

<!-- Blur target -->
<div id="app" class="relative z-10">
  <div class="max-w-7xl mx-auto p-4">

    <div class="flex flex-wrap gap-3 justify-between items-center mb-4">
      <div class="flex items-center gap-3">
        <div class="brand-badge">
          <span class="brand-dot"></span>
          <span class="font-bold tracking-wide">Projections Hub</span>
        </div>
        <h1 id="pageTitle" class="text-2xl md:text-3xl font-bold">Main Menu</h1>
      </div>

      <div class="flex gap-2 flex-wrap">
        <button onclick="goHome()" class="btn btn-soft">Home</button>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-[260px,1fr] gap-4">

      <!-- NAV SIDEBAR: hidden on home, shown on other pages -->
      <aside id="navAside" class="glass-card p-3 md:p-4 hidden">
        <div class="mb-3">
          <div class="text-xs uppercase tracking-widest opacity-70 mb-2">Navigation</div>
        </div>

        <div class="flex flex-col gap-2">
          <button onclick="loadLeague('nhl','proj')" class="nav-btn">
            <span class="nav-icon">üèí</span>
            <span class="flex-1 text-left"><div class="font-semibold">NHL Projections</div></span>
            <span class="nav-arrow">‚Üí</span>
          </button>

          <button onclick="loadLeague('nhl','lineup')" class="nav-btn">
            <span class="nav-icon">üìã</span>
            <span class="flex-1 text-left"><div class="font-semibold">NHL Draft</div></span>
            <span class="nav-arrow">‚Üí</span>
          </button>

          <button onclick="loadLeague('nhl','team')" class="nav-btn">
            <span class="nav-icon">üèÜ</span>
            <span class="flex-1 text-left"><div class="font-semibold">NHL Best Team</div></span>
            <span class="nav-arrow">‚Üí</span>
          </button>

          <!-- NEW -->
          <button onclick="loadLeague('nhl','best_lineups')" class="nav-btn">
            <span class="nav-icon">üî•</span>
            <span class="flex-1 text-left"><div class="font-semibold">NHL Top 10 Lineups</div></span>
            <span class="nav-arrow">‚Üí</span>
          </button>

          <div class="h-px my-2 bg-white/10"></div>

          <button onclick="loadLeague('nba','proj')" class="nav-btn">
            <span class="nav-icon">üèÄ</span>
            <span class="flex-1 text-left"><div class="font-semibold">NBA Projections</div></span>
            <span class="nav-arrow">‚Üí</span>
          </button>

          <button onclick="loadLeague('nba','lineup')" class="nav-btn">
            <span class="nav-icon">üìã</span>
            <span class="flex-1 text-left"><div class="font-semibold">NBA Draft</div></span>
            <span class="nav-arrow">‚Üí</span>
          </button>
        </div>
      </aside>

      <main class="glass-card p-3 md:p-4 min-h-[420px]">
        <!-- MAIN PAGE IS NAVIGATION -->
        <div id="homeView" class="fade-in">
          <div class="hero-card p-6 md:p-8 mb-4">
            <div class="hero-glow" aria-hidden="true"></div>
            <div class="relative z-10">
              <div class="text-xs uppercase tracking-[0.25em] opacity-70 mb-2">Main Menu</div>
              <div class="text-2xl md:text-3xl font-extrabold leading-tight">Choose a tab</div>
              <div class="mt-2 text-sm opacity-80">Navigation is here on the main page. Sidebar only appears after you open a page.</div>
            </div>
          </div>

          <!-- Big nav buttons on main page -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <button onclick="loadLeague('nhl','proj')" class="nav-btn">
              <span class="nav-icon">üèí</span>
              <span class="flex-1 text-left"><div class="font-semibold">NHL Projections</div></span>
              <span class="nav-arrow">‚Üí</span>
            </button>

            <button onclick="loadLeague('nhl','lineup')" class="nav-btn">
              <span class="nav-icon">üìã</span>
              <span class="flex-1 text-left"><div class="font-semibold">NHL Draft</div></span>
              <span class="nav-arrow">‚Üí</span>
            </button>

            <button onclick="loadLeague('nhl','team')" class="nav-btn">
              <span class="nav-icon">üèÜ</span>
              <span class="flex-1 text-left"><div class="font-semibold">NHL Best Team</div></span>
              <span class="nav-arrow">‚Üí</span>
            </button>

            <!-- NEW -->
            <button onclick="loadLeague('nhl','best_lineups')" class="nav-btn">
              <span class="nav-icon">üî•</span>
              <span class="flex-1 text-left"><div class="font-semibold">NHL Top 10 Lineups</div></span>
              <span class="nav-arrow">‚Üí</span>
            </button>

            <button onclick="loadLeague('nba','proj')" class="nav-btn">
              <span class="nav-icon">üèÄ</span>
              <span class="flex-1 text-left"><div class="font-semibold">NBA Projections</div></span>
              <span class="nav-arrow">‚Üí</span>
            </button>

            <button onclick="loadLeague('nba','lineup')" class="nav-btn">
              <span class="nav-icon">üìã</span>
              <span class="flex-1 text-left"><div class="font-semibold">NBA Draft</div></span>
              <span class="nav-arrow">‚Üí</span>
            </button>
          </div>
        </div>

        <div id="searchWrap" class="mb-4 hidden fade-in">
          <input id="playerSearch" placeholder="Search player"
            class="px-3 py-2 rounded border w-full max-w-sm bg-white/5 backdrop-blur-md border-white/10 focus:outline-none focus:ring-2 focus:ring-emerald-200/20">
        </div>

        <div id="loading" class="hidden text-center py-10 text-lg fade-in">
          <div class="spinner mx-auto mb-3"></div>
          Loading data...
        </div>

        <div id="projectionView" class="overflow-x-auto rounded-lg hidden fade-in"></div>

        <div id="lineupView" class="hidden mt-2 fade-in">
          <h2 class="text-2xl font-bold mb-2">Optimal Lineup</h2>
          <div class="table-wrap">
            <table class="w-full rounded-lg overflow-hidden">
              <thead class="bg-white/10">
                <tr>
                  <th class="p-2 text-left">Player</th>
                  <th class="p-2 text-right">Proj</th>
                  <th class="p-2 text-right">Boost</th>
                  <th class="p-2 text-right">Mult</th>
                  <th class="p-2 text-right">Score</th>
                </tr>
              </thead>
              <tbody id="lineupBody" class="bg-white/5"></tbody>
              <tfoot>
                <tr class="font-bold border-t border-white/10">
                  <td class="p-2">Total</td>
                  <td colspan="4" id="lineupTotal" class="p-2 text-right"></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>

        <!-- TEAM VIEW -->
        <div id="teamView" class="hidden mt-2 fade-in">
          <div class="flex flex-wrap items-end justify-between gap-2 mb-3">
            <div>
              <h2 class="text-2xl font-bold">Top Team Stacks</h2>
            </div>
            <div class="text-xs opacity-70">
              Highest teams at the top
            </div>
          </div>

          <div id="teamRankList" class="space-y-3"></div>
        </div>

        <!-- NEW: TOP 10 LINEUPS VIEW -->
        <div id="bestLineupsView" class="hidden mt-2 fade-in">
          <div class="flex flex-wrap items-end justify-between gap-2 mb-3">
            <div>
              <h2 class="text-2xl font-bold">Top 10 Lineups</h2>
              <div class="text-xs opacity-70 mt-1">From <span class="font-semibold">NHL_BEST_LINEUPS</span></div>
            </div>
            <div class="text-xs opacity-70">
              Showing 10 lineups
            </div>
          </div>

          <div id="bestLineupsList" class="space-y-4"></div>
        </div>

      </main>
    </div>

    <div class="mt-4 text-xs opacity-70 flex items-center justify-end">
      <div class="opacity-70">Created by croze</div>
    </div>

  </div>
</div>

<script>
const BASE_URL =
"https://script.google.com/macros/s/AKfycbyINrZV6oyDhAQKeeuui5TOhTMKsZABb0SHYHbN4LXPFNBRykOBj0rvMAjXGMdJtf6U/exec";

let league = "nhl";
let mode = "home";
let allData = [];

// NEW: best lineups data
let bestLineups = [];

// NEW: sorting state for projections table
let sortKey = null;   // e.g. "projection", "b3", "player"
let sortDir = "desc"; // "asc" or "desc"

/* ===== Blur-only transition during loading ===== */
function startTransition() {
  const o = document.getElementById("transitionOverlay");
  o.classList.remove("hidden");
  document.documentElement.classList.add("is-transitioning");
}
function endTransition() {
  const o = document.getElementById("transitionOverlay");
  o.classList.add("out");
  setTimeout(() => {
    o.classList.add("hidden");
    o.classList.remove("out");
    document.documentElement.classList.remove("is-transitioning");
  }, 240);
}

/* ===== UI helpers ===== */
function setSidebarVisible(isVisible) {
  const nav = document.getElementById("navAside");
  nav.classList.toggle("hidden", !isVisible);
}
function setViewsVisible({ home=false, proj=false, lineup=false, team=false, bestLineupsPage=false, search=false }) {
  homeView.classList.toggle("hidden", !home);
  projectionView.classList.toggle("hidden", !proj);
  lineupView.classList.toggle("hidden", !lineup);
  teamView.classList.toggle("hidden", !team);
  bestLineupsView.classList.toggle("hidden", !bestLineupsPage);
  searchWrap.classList.toggle("hidden", !search);
}

/* ===== Home ===== */
async function goHome() {
  startTransition();

  mode = "home";
  pageTitle.textContent = "Main Menu";

  setSidebarVisible(false);                 // sidebar only on pages (not home)
  setViewsVisible({ home:true });           // main page = navigation

  loading.classList.add("hidden");
  endTransition();
}

/* ===== Page loading ===== */
async function loadLeague(lg, md) {
  startTransition();

  league = lg;
  mode = md;

  // reset sorting when switching leagues/modes
  sortKey = null;
  sortDir = "desc";

  // Sidebar appears on "certain page" (anything not home)
  setSidebarVisible(true);

  pageTitle.textContent =
    lg.toUpperCase() + (
      md === "proj" ? " Projections" :
      md === "lineup" ? " Today‚Äôs Draft" :
      md === "team" ? " Best Team" :
      md === "best_lineups" ? " Top 10 Lineups" :
      ""
    );

  // Hide everything first
  setViewsVisible({ home:false, proj:false, lineup:false, team:false, bestLineupsPage:false, search:false });

  // Toggle the correct view
  const showProj = (md === "proj");
  const showLineup = (md === "lineup");
  const showTeam = (md === "team");
  const showBestLineups = (md === "best_lineups");

  setViewsVisible({
    proj: showProj,
    lineup: showLineup,
    team: showTeam,
    bestLineupsPage: showBestLineups,
    search: showProj
  });

  loading.classList.remove("hidden");

  try {
    if (md === "best_lineups") {
      // NEW endpoint parameter "sheet=NHL_BEST_LINEUPS"
      const res = await fetch(`${BASE_URL}?league=${lg}&sheet=NHL_BEST_LINEUPS`);
      bestLineups = await res.json();
    } else {
      const res = await fetch(`${BASE_URL}?league=${lg}`);
      allData = await res.json();
    }
  } finally {
    loading.classList.add("hidden");
  }

  if (md === "proj") renderTable();
  else if (md === "lineup") computeLineup();
  else if (md === "team") computeRankedTeamStacks();
  else if (md === "best_lineups") renderBestLineups();

  endTransition();
}

/* ================= SORTING HELPERS ================= */
function safeNum(v) {
  const n = Number(v);
  return Number.isFinite(n) ? n : 0;
}
function safeStr(v) {
  return (v ?? "").toString().toLowerCase();
}
function setSort(key) {
  if (sortKey === key) {
    sortDir = (sortDir === "asc") ? "desc" : "asc";
  } else {
    sortKey = key;
    sortDir = (key === "player" || key === "team") ? "asc" : "desc";
  }
  renderTable();
}
function sortArrowFor(key) {
  if (sortKey !== key) return `<span class="th-arrow opacity-40">‚Üï</span>`;
  return sortDir === "asc"
    ? `<span class="th-arrow">‚Üë</span>`
    : `<span class="th-arrow">‚Üì</span>`;
}
function th(label, key, alignRight=false, center=false) {
  const align =
    center ? "text-center" :
    alignRight ? "text-right" : "text-left";
  return `
    <th class="p-2 ${align}">
      <button class="th-btn" onclick="setSort('${key}')">
        <span>${label}</span>
        ${sortArrowFor(key)}
      </button>
    </th>
  `;
}

/* ================= TABLE (SORTABLE) ================= */
function renderTable() {
  const search = playerSearch.value.toLowerCase();

  let rows = allData.filter(p =>
    !search || (p.player || "").toLowerCase().includes(search)
  );

  if (sortKey) {
    rows = rows.slice().sort((a, b) => {
      let av, bv;

      if (sortKey === "player" || sortKey === "team") {
        av = safeStr(a[sortKey]);
        bv = safeStr(b[sortKey]);
        if (av < bv) return sortDir === "asc" ? -1 : 1;
        if (av > bv) return sortDir === "asc" ? 1 : -1;
        return 0;
      }

      av = safeNum(a[sortKey]);
      bv = safeNum(b[sortKey]);
      return sortDir === "asc" ? (av - bv) : (bv - av);
    });
  }

  let html = `
  <table class="w-full text-sm rounded-lg overflow-hidden">
    <thead class="bg-white/10">
      <tr>
        ${th("Player","player")}
        ${league === "nhl" ? `
          ${th("Team","team",false,true)}
          ${th("G","goals",true)}
          ${th("A","assists",true)}
          ${th("P","points",true)}
          ${th("SOG","shots",true)}
          ${th("BLK","blocks",true)}
        ` : ``}
        ${th("Proj","projection",true)}
        ${th("Boost","boost",true)}
        ${th("B1","b1",true)}
        ${th("B2","b2",true)}
        ${th("B3","b3",true)}
        ${th("B4","b4",true)}
        ${th("B5","b5",true)}
      </tr>
    </thead><tbody class="bg-white/5">`;

  rows.forEach(p => {
    html += `
    <tr class="border-t border-white/10 hover-row">
      <td class="p-2">${p.player ?? ""}</td>
      ${league === "nhl" ? `
        <td class="p-2 text-center">${p.team ?? ""}</td>
        <td class="p-2 text-right">${safeNum(p.goals).toFixed(2)}</td>
        <td class="p-2 text-right">${safeNum(p.assists).toFixed(2)}</td>
        <td class="p-2 text-right">${safeNum(p.points).toFixed(2)}</td>
        <td class="p-2 text-right">${safeNum(p.shots).toFixed(1)}</td>
        <td class="p-2 text-right">${safeNum(p.blocks).toFixed(1)}</td>` : ``}
      <td class="p-2 text-right">${safeNum(p.projection).toFixed(2)}</td>
      <td class="p-2 text-right text-emerald-200">${safeNum(p.boost).toFixed(1)}</td>
      <td class="p-2 text-right">${safeNum(p.b1).toFixed(2)}</td>
      <td class="p-2 text-right">${safeNum(p.b2).toFixed(2)}</td>
      <td class="p-2 text-right">${safeNum(p.b3).toFixed(2)}</td>
      <td class="p-2 text-right">${safeNum(p.b4).toFixed(2)}</td>
      <td class="p-2 text-right">${safeNum(p.b5).toFixed(2)}</td>
    </tr>`;
  });

  projectionView.innerHTML = html + "</tbody></table>";
}

/* ================= LINEUP ================= */
function computeBestLineupFromPool(pool) {
  const mults = [2, 1.8, 1.6, 1.4, 1.2];
  if (!Array.isArray(pool) || pool.length < 5) return null;

  const perms = [];
  (function permute(a, l) {
    if (l === a.length) return perms.push(a.slice());
    for (let i = l; i < a.length; i++) {
      [a[l], a[i]] = [a[i], a[l]];
      permute(a, l + 1);
      [a[l], a[i]] = [a[i], a[l]];
    }
  })(mults.slice(), 0);

  let best = { score: -1 };

  function choose(start, picked) {
    if (picked.length === 5) {
      perms.forEach(m => {
        let s = 0;
        for (let i = 0; i < 5; i++) {
          s += safeNum(picked[i].projection) * (m[i] + safeNum(picked[i].boost));
        }
        if (s > best.score)
          best = { score: s, players: picked.slice(), mults: m.slice() };
      });
      return;
    }
    for (let i = start; i < pool.length; i++) {
      choose(i + 1, picked.concat(pool[i]));
    }
  }

  choose(0, []);
  return best;
}

function computeLineup() {
  const pool = [...allData]
    .sort((a, b) => safeNum(b.b3) - safeNum(a.b3))
    .slice(0, 20);

  const best = computeBestLineupFromPool(pool);
  if (!best) return;
  renderLineup(best);
}

function renderLineup(best) {
  lineupBody.innerHTML = "";

  const rows = best.players.map((p, i) => ({
    p,
    m: best.mults[i],
    s: safeNum(p.projection) * (best.mults[i] + safeNum(p.boost))
  })).sort((a, b) => b.m - a.m);

  rows.forEach(r => {
    lineupBody.insertAdjacentHTML("beforeend", `
      <tr class="border-t border-white/10 hover-row">
        <td class="p-2">${r.p.player ?? ""}</td>
        <td class="p-2 text-right">${safeNum(r.p.projection).toFixed(2)}</td>
        <td class="p-2 text-right text-emerald-200">${safeNum(r.p.boost).toFixed(1)}</td>
        <td class="p-2 text-right">${r.m.toFixed(1)}</td>
        <td class="p-2 text-right font-bold">${safeNum(r.s).toFixed(2)}</td>
      </tr>
    `);
  });

  lineupTotal.textContent = best.score.toFixed(2);
}

/* ================= TEAM STACK RANKING LIST ================= */
function playerStackValue(p) {
  return safeNum(p.b3) + safeNum(p.b4) + safeNum(p.b5);
}
function buildTeamStackByB345(players) {
  const mults = [2, 1.8, 1.6, 1.4, 1.2];
  if (!Array.isArray(players) || players.length < 5) return null;

  const picked = players
    .slice()
    .sort((a, b) => playerStackValue(b) - playerStackValue(a))
    .slice(0, 5);

  const rows = picked
    .slice()
    .sort((a, b) => playerStackValue(b) - playerStackValue(a))
    .map((p, i) => {
      const val = playerStackValue(p);
      const m = mults[i];
      const score = val * m;
      return { p, m, score };
    });

  const total = rows.reduce((s, r) => s + r.score, 0);
  return { rows, total };
}
function computeRankedTeamStacks() {
  teamRankList.innerHTML = "";

  const byTeam = {};
  allData.forEach(p => {
    const t = (p.team ?? "").toString().trim();
    if (!t) return;
    if (!byTeam[t]) byTeam[t] = [];
    byTeam[t].push(p);
  });

  const teams = Object.entries(byTeam)
    .map(([team, players]) => {
      const stack = buildTeamStackByB345(players);
      if (!stack) return null;
      return { team, ...stack };
    })
    .filter(Boolean)
    .sort((a, b) => b.total - a.total);

  if (!teams.length) {
    teamRankList.innerHTML = `
      <div class="p-4 rounded-xl border border-white/10 bg-white/5">
        <div class="font-semibold">No team data found</div>
      </div>
    `;
    return;
  }

  teams.forEach((t, idx) => {
    const medal =
      idx === 0 ? "ü•á" :
      idx === 1 ? "ü•à" :
      idx === 2 ? "ü•â" : "üèí";

    const playersInline = t.rows.map(r => {
      return `
        <span class="chip">
          <span class="chip-name">${r.p.player ?? ""}</span>
        </span>
      `;
    }).join("");

    teamRankList.insertAdjacentHTML("beforeend", `
      <div class="team-card hover-row">
        <div class="flex items-center justify-between gap-3 flex-wrap">
          <div class="flex items-center gap-3">
            <div class="rank-badge">${medal} #${idx + 1}</div>
            <div>
              <div class="text-lg font-bold tracking-wide">${t.team}</div>
            </div>
          </div>

          <div class="text-right">
            <div class="text-xs uppercase tracking-widest opacity-70">Total Score</div>
            <div class="text-xl font-extrabold text-emerald-200">${t.total.toFixed(2)}</div>
          </div>
        </div>

        <div class="chips mt-3">
          ${playersInline}
        </div>
      </div>
    `);
  });
}

/* ================= NEW: TOP 10 LINEUPS =================
   Expected NHL_BEST_LINEUPS rows to have something like:
   {
     players: ["A", "B", "C", "D", "E"] OR players: "A, B, C, D, E"
     objective: number
     expected: number
     sd: number
     synergy: number
   }
   If your sheet uses different column names, adjust the key mapping below.
*/
function normalizePlayersField(row) {
  if (Array.isArray(row.players)) return row.players;
  if (typeof row.players === "string") {
    return row.players.split(",").map(s => s.trim()).filter(Boolean);
  }

  // fallback: try common sheet column names like p1..p5
  const maybe = ["p1","p2","p3","p4","p5"].map(k => row[k]).filter(Boolean);
  if (maybe.length) return maybe.map(x => x.toString().trim());

  return [];
}
function renderBestLineups() {
  bestLineupsList.innerHTML = "";

  const rows = Array.isArray(bestLineups) ? bestLineups.slice() : [];
  const top10 = rows.slice(0, 10);

  if (!top10.length) {
    bestLineupsList.innerHTML = `
      <div class="p-4 rounded-xl border border-white/10 bg-white/5">
        <div class="font-semibold">No lineups found</div>
        <div class="text-xs opacity-70 mt-1">Make sure your Apps Script returns data for sheet NHL_BEST_LINEUPS.</div>
      </div>
    `;
    return;
  }

  top10.forEach((r, idx) => {
    const players = normalizePlayersField(r);

    const objective = safeNum(r.objective ?? r.obj ?? r.Objective);
    const expected = safeNum(r.expected ?? r.exp ?? r.Expected);
    const sd = safeNum(r.sd ?? r.SD ?? r.stdev ?? r.std);
    const synergy = safeNum(r.synergy ?? r.syn ?? r.Synergy);

    const playersHtml = players.length
      ? players.map(p => `<span class="chip"><span class="chip-name">${p}</span></span>`).join("")
      : `<span class="text-xs opacity-70">No players field found</span>`;

    bestLineupsList.insertAdjacentHTML("beforeend", `
      <div class="team-card hover-row">
        <div class="flex items-center justify-between gap-3 flex-wrap">
          <div class="flex items-center gap-3">
            <div class="rank-badge">üî• #${idx + 1}</div>
            <div class="text-lg font-bold tracking-wide">Lineup</div>
          </div>

          <div class="flex flex-wrap gap-3 text-right">
            <div>
              <div class="text-xs uppercase tracking-widest opacity-70">Objective</div>
              <div class="text-lg font-extrabold text-emerald-200">${objective.toFixed(2)}</div>
            </div>
            <div>
              <div class="text-xs uppercase tracking-widest opacity-70">Expected</div>
              <div class="text-lg font-extrabold">${expected.toFixed(2)}</div>
            </div>
            <div>
              <div class="text-xs uppercase tracking-widest opacity-70">SD</div>
              <div class="text-lg font-extrabold">${sd.toFixed(2)}</div>
            </div>
            <div>
              <div class="text-xs uppercase tracking-widest opacity-70">Synergy</div>
              <div class="text-lg font-extrabold">${synergy.toFixed(2)}</div>
            </div>
          </div>
        </div>

        <div class="chips mt-3">
          ${playersHtml}
        </div>
      </div>
    `);
  });
}

playerSearch.addEventListener("input", renderTable);
goHome();
</script>

<style>
/* Blur the whole app while transitioning */
.is-transitioning #app{
  filter: blur(12px) saturate(1.15);
  transform: translateZ(0);
}

/* Blur-only overlay */
.transition-overlay{
  position: fixed;
  inset: 0;
  z-index: 9999;
  pointer-events: none;
  opacity: 0;
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  transition: opacity .18s ease;
}
.transition-overlay.out{
  opacity: 0;
  transition: opacity .22s ease;
}

/* We keep a very subtle dark veil (no color shifting) */
.transition-overlay::before{
  content:"";
  position:absolute;
  inset:0;
  background: rgba(2,6,23,.35);
}

/* Make it visible during transition */
.is-transitioning #transitionOverlay{
  opacity: 1;
}

/* Buttons */
.btn{
  padding:.55rem 1rem;border-radius:.6rem;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.10);
  backdrop-filter: blur(10px);-webkit-backdrop-filter: blur(10px);
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
}
.btn:hover{ transform: translateY(-2px); box-shadow: 0 16px 40px rgba(0,0,0,.55); background: rgba(255,255,255,.08); }
.btn:active{ transform: translateY(0); }
.btn-soft{ background: rgba(255,255,255,.05); }

.glass-card{
  border-radius: 1rem;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(2,6,23,.35);
  box-shadow: 0 18px 55px rgba(0,0,0,.55);
  backdrop-filter: blur(14px);-webkit-backdrop-filter: blur(14px);
}

.nav-btn{
  display:flex;align-items:center;gap:.75rem;
  padding:.85rem .9rem;border-radius:.9rem;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.05);
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
}
.nav-btn:hover{ transform: translateY(-2px); background: rgba(255,255,255,.08); box-shadow: 0 16px 38px rgba(0,0,0,.55); }
.nav-icon{
  width: 38px;height: 38px;display:grid;place-items:center;
  border-radius: .85rem;background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.10);
}
.nav-arrow{ opacity:.75; transition: transform .18s ease, opacity .18s ease; }
.nav-btn:hover .nav-arrow{ transform: translateX(3px); opacity: 1; }

.hero-card{
  position: relative;border-radius: 1.25rem;overflow: hidden;
  border: 1px solid rgba(255,255,255,.10);
  background: linear-gradient(120deg,
    rgba(16,185,129,.16),
    rgba(34,211,238,.14),
    rgba(16,185,129,.10),
    rgba(34,211,238,.10)
  );
  box-shadow: 0 24px 70px rgba(0,0,0,.55);
}
.hero-glow{
  position:absolute; inset:-60px;
  background:
    radial-gradient(circle at 18% 30%, rgba(16,185,129,.55), transparent 55%),
    radial-gradient(circle at 82% 40%, rgba(34,211,238,.52), transparent 55%),
    radial-gradient(circle at 55% 88%, rgba(16,185,129,.40), transparent 60%),
    radial-gradient(circle at 35% 70%, rgba(34,211,238,.32), transparent 60%);
  filter: blur(20px); opacity:.85;
  animation: floatGlow 10s ease-in-out infinite;
}

.brand-badge{
  display:flex;align-items:center;gap:.5rem;
  padding:.4rem .7rem;border-radius: 999px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.05);
  backdrop-filter: blur(12px);
}
.brand-dot{
  width:10px;height:10px;border-radius:999px;
  background: linear-gradient(90deg, rgba(16,185,129,1), rgba(34,211,238,1));
  box-shadow: 0 0 18px rgba(34,211,238,.25);
  animation: pulseDot 2.2s ease-in-out infinite;
}

.table-wrap{ border-radius: 1rem; overflow: hidden; border: 1px solid rgba(255,255,255,.10); }
.hover-row{ transition: transform .14s ease, background .14s ease; }
.hover-row:hover{ transform: translateX(2px); background: rgba(255,255,255,.06); }

.fade-in{ animation: fadeInUp .28s ease both; }
@keyframes fadeInUp{ from{opacity:0;transform: translateY(10px);} to{opacity:1;transform: translateY(0);} }

.spinner{
  width: 36px;height: 36px;border-radius: 999px;
  border: 3px solid rgba(255,255,255,.18);
  border-top-color: rgba(34,211,238,.65);
  animation: spin 1s linear infinite;
}
@keyframes spin{ to{ transform: rotate(360deg); } }

.aurora-bg{
  position: fixed; inset: -30%; z-index: 0;
  background:
    radial-gradient(circle at 12% 22%, rgba(16,185,129,.42), transparent 58%),
    radial-gradient(circle at 86% 28%, rgba(34,211,238,.40), transparent 58%),
    radial-gradient(circle at 50% 86%, rgba(16,185,129,.34), transparent 62%),
    radial-gradient(circle at 28% 72%, rgba(34,211,238,.28), transparent 62%),
    radial-gradient(circle at 70% 68%, rgba(16,185,129,.24), transparent 64%);
  filter: blur(22px) saturate(1.35);
  animation: auroraMove 12s ease-in-out infinite;
}
.aurora-noise{
  position: fixed; inset: 0; z-index: 1;
  pointer-events: none; opacity: .08;
  background-image:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='320' height='320'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='320' height='320' filter='url(%23n)' opacity='.6'/%3E%3C/svg%3E");
  mix-blend-mode: overlay;
}

@keyframes auroraMove{
  0%{ transform: translate3d(-2%, -1%, 0) scale(1.02); }
  50%{ transform: translate3d(2%, 1%, 0) scale(1.05); }
  100%{ transform: translate3d(-2%, -1%, 0) scale(1.02); }
}
@keyframes floatGlow{
  0%{ transform: translate3d(-1%, -1%, 0) scale(1.02); }
  50%{ transform: translate3d(1%, 1%, 0) scale(1.05); }
  100%{ transform: translate3d(-1%, -1%, 0) scale(1.02); }
}
@keyframes pulseDot{
  0%,100%{ transform: scale(1); opacity: .9; }
  50%{ transform: scale(1.18); opacity: 1; }
}

/* Sortable header button */
.th-btn{
  width: 100%;
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: .5rem;
  font-weight: 700;
  opacity: .95;
}
.th-btn:hover{ opacity: 1; }
.th-arrow{ font-size: .9rem; opacity: .85; }

/* Team / card styling */
.team-card{
  border-radius: 1rem;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  padding: 1rem;
  box-shadow: 0 18px 55px rgba(0,0,0,.45);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
}
.rank-badge{
  padding: .35rem .65rem;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
  font-weight: 700;
  font-size: .85rem;
  letter-spacing: .02em;
}
.chips{
  display:flex;
  flex-wrap: wrap;
  gap: .5rem;
}
.chip{
  display:flex;
  align-items:center;
  gap:.5rem;
  padding: .35rem .55rem;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(2,6,23,.35);
}
.chip-name{
  font-weight: 650;
  font-size: .85rem;
}
</style>

</body>
</html>
