<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NHL Projections</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      darkMode: 'class'
    }
  </script>
</head>

<body class="bg-slate-100 text-slate-900 dark:bg-slate-900 dark:text-slate-100">

<div class="max-w-7xl mx-auto p-4">

  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4 gap-4">
    <h1 class="text-3xl font-bold">NHL Projections</h1>

    <button onclick="toggleTheme()"
      class="px-4 py-2 rounded bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600">
      üåô / ‚òÄÔ∏è
    </button>
  </div>

  <!-- Controls -->
  <div class="flex flex-wrap gap-3 mb-4">
    <input id="playerSearch"
      type="text"
      placeholder="Search player"
      class="px-3 py-2 rounded border dark:border-slate-700 bg-white dark:bg-slate-800">

    <input id="minProj"
      type="number"
      step="0.1"
      placeholder="Min Projection"
      class="px-3 py-2 rounded border dark:border-slate-700 bg-white dark:bg-slate-800">

    <button onclick="loadData()"
      class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">
      Refresh
    </button>
  </div>

  <!-- Loading -->
  <div id="loading" class="hidden text-center py-6 text-lg">
    Loading NHL data...
  </div>

  <!-- Table -->
  <div class="overflow-x-auto rounded-lg">
    <table class="w-full border-collapse bg-white dark:bg-slate-800">
      <thead class="sticky top-0 bg-slate-200 dark:bg-slate-700">
        <tr>
          <th onclick="sortBy('player')" class="p-2 cursor-pointer">Player</th>
          <th onclick="sortBy('projection')" class="p-2 cursor-pointer">Projection</th>
          <th onclick="sortBy('boost')" class="p-2 cursor-pointer">Boost</th>
          <th onclick="sortBy('b1')" class="p-2 cursor-pointer">B1</th>
          <th onclick="sortBy('b2')" class="p-2 cursor-pointer">B2</th>
          <th onclick="sortBy('b3')" class="p-2 cursor-pointer">B3</th>
          <th onclick="sortBy('b4')" class="p-2 cursor-pointer">B4</th>
          <th onclick="sortBy('b5')" class="p-2 cursor-pointer">B5</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

</div>

<script>
const DATA_URL =
  "https://script.google.com/macros/s/AKfycbxhMK_vKv7SFxoyIGmf8yHmi74-8BX592IE7PrQxR6WSUh8C-7vSom1kt04n0tNT1vE/exec";

let allData = [];
let sortKey = "projection";
let sortDir = -1;

/* ------------------ DATA ------------------ */
async function loadData() {
  document.getElementById("loading").classList.remove("hidden");

  const res = await fetch(DATA_URL);
  allData = await res.json();

  document.getElementById("loading").classList.add("hidden");
  render();
}

/* ------------------ RENDER ------------------ */
function render() {
  const min = parseFloat(document.getElementById("minProj").value) || -Infinity;
  const search = document.getElementById("playerSearch").value.toLowerCase();

  let filtered = allData.filter(p =>
    (p.projection || 0) >= min &&
    (!search || (p.player || "").toLowerCase().includes(search))
  );

  filtered.sort((a, b) => {
    const x = a[sortKey] ?? 0;
    const y = b[sortKey] ?? 0;
    return (x > y ? 1 : -1) * sortDir;
  });

  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";

  filtered.forEach(p => {
    tbody.insertAdjacentHTML("beforeend", `
      <tr class="border-t dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-700">
        <td class="p-2 text-left">${p.player || ""}</td>
        <td class="p-2 text-right">${(p.projection ?? 0).toFixed(2)}</td>
        <td class="p-2 text-right text-green-400 font-bold">${(p.boost ?? 0).toFixed(1)}</td>
        <td class="p-2 text-right">${(p.b1 ?? 0).toFixed(2)}</td>
        <td class="p-2 text-right">${(p.b2 ?? 0).toFixed(2)}</td>
        <td class="p-2 text-right">${(p.b3 ?? 0).toFixed(2)}</td>
        <td class="p-2 text-right">${(p.b4 ?? 0).toFixed(2)}</td>
        <td class="p-2 text-right">${(p.b5 ?? 0).toFixed(2)}</td>
      </tr>
    `);
  });
}

/* ------------------ SORT ------------------ */
function sortBy(key) {
  if (sortKey === key) sortDir *= -1;
  else {
    sortKey = key;
    sortDir = -1;
  }
  render();
}

/* ------------------ THEME ------------------ */
function toggleTheme() {
  document.documentElement.classList.toggle("dark");
}

/* Live search */
document.getElementById("playerSearch").addEventListener("input", render);
document.getElementById("minProj").addEventListener("input", render);

/* Initial load */
loadData();
</script>

</body>
</html>
