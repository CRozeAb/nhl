<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sports Projections Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' }
  </script>
</head>

<body class="bg-slate-100 text-slate-900 dark:bg-slate-900 dark:text-slate-100">

<div class="max-w-7xl mx-auto p-4">

  <!-- HEADER -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Projection Hub</h1>

    <div class="flex gap-2">
      <button onclick="setView('nhlProj')" class="menu-btn">NHL Projections</button>
      <button onclick="setView('nhlDraft')" class="menu-btn">Today‚Äôs NHL Draft</button>
      <button onclick="setView('nbaProj')" class="menu-btn">NBA Projections</button>
      <button onclick="setView('nbaDraft')" class="menu-btn">Today‚Äôs NBA Draft</button>

      <button onclick="toggleTheme()"
        class="px-3 py-2 rounded bg-slate-300 dark:bg-slate-700">
        üåô / ‚òÄÔ∏è
      </button>
    </div>
  </div>

  <!-- LOADING -->
  <div id="loading" class="hidden text-center py-6 text-lg">
    Loading data...
  </div>

  <!-- ================= NHL PROJECTIONS ================= -->
  <section id="nhlProj" class="view hidden">
    <h2 class="text-2xl font-bold mb-4">NHL Projections</h2>
    <div id="nhlTable"></div>
  </section>

  <!-- ================= NHL DRAFT ================= -->
  <section id="nhlDraft" class="view hidden">
    <h2 class="text-2xl font-bold mb-4">Today‚Äôs NHL Draft</h2>
    <div id="nhlLineup"></div>
  </section>

  <!-- ================= NBA PROJECTIONS ================= -->
  <section id="nbaProj" class="view hidden">
    <h2 class="text-2xl font-bold mb-4">NBA Projections</h2>
    <div id="nbaTable"></div>
  </section>

  <!-- ================= NBA DRAFT ================= -->
  <section id="nbaDraft" class="view hidden">
    <h2 class="text-2xl font-bold mb-4">Today‚Äôs NBA Draft</h2>
    <div id="nbaLineup"></div>
  </section>

</div>

<script>
/* ================= CONFIG ================= */
const NHL_DATA_URL =
"https://script.google.com/macros/s/AKfycbxhMK_vKv7SFxoyIGmf8yHmi74-8BX592IE7PrQxR6WSUh8C-7vSom1kt04n0tNT1vE/exec";

/* Replace later when NBA script is ready */
const NBA_DATA_URL = "NBA_SCRIPT_URL_HERE";

const MULTS = [2, 1.8, 1.6, 1.4, 1.2];

/* ================= STATE ================= */
let nhlData = [];
let nbaData = [];

/* ================= MENU ================= */
function setView(id) {
  document.querySelectorAll(".view").forEach(v => v.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");

  if (id === "nhlProj") renderTable(nhlData, "nhlTable", true);
  if (id === "nbaProj") renderTable(nbaData, "nbaTable", false);
  if (id === "nhlDraft") renderDraft(nhlData, "nhlLineup");
  if (id === "nbaDraft") renderDraft(nbaData, "nbaLineup");
}

/* ================= LOAD ================= */
async function loadData() {
  loading.classList.remove("hidden");

  const nhlRes = await fetch(NHL_DATA_URL);
  nhlData = await nhlRes.json();

  /* NBA optional until ready */
  try {
    const nbaRes = await fetch(NBA_DATA_URL);
    nbaData = await nbaRes.json();
  } catch {
    nbaData = [];
  }

  loading.classList.add("hidden");
  setView("nhlProj");
}

/* ================= TABLE ================= */
function renderTable(data, targetId, isNHL) {
  if (!data.length) {
    document.getElementById(targetId).innerHTML =
      "<p class='text-slate-400'>No data available</p>";
    return;
  }

  const headers = isNHL
    ? ["Player","Proj","Boost","B1","B2","B3","B4","B5"]
    : ["Player","Proj","Boost","PB1","PB2","PB3","PB4","PB5"];

  let html = `<table class="w-full bg-white dark:bg-slate-800 text-sm rounded-lg">
    <thead class="bg-slate-200 dark:bg-slate-700">
      <tr>${headers.map(h=>`<th class="p-2">${h}</th>`).join("")}</tr>
    </thead><tbody>`;

  data.forEach(p => {
    html += `<tr class="border-t dark:border-slate-700">
      <td class="p-2">${p.player}</td>
      <td class="p-2 text-right">${p.projection.toFixed(2)}</td>
      <td class="p-2 text-right text-green-400">${p.boost.toFixed(1)}</td>
      <td class="p-2 text-right">${p.b1.toFixed(2)}</td>
      <td class="p-2 text-right">${p.b2.toFixed(2)}</td>
      <td class="p-2 text-right">${p.b3.toFixed(2)}</td>
      <td class="p-2 text-right">${p.b4.toFixed(2)}</td>
      <td class="p-2 text-right">${p.b5.toFixed(2)}</td>
    </tr>`;
  });

  html += "</tbody></table>";
  document.getElementById(targetId).innerHTML = html;
}

/* ================= OPTIMIZER ================= */
function renderDraft(data, targetId) {
  if (!data.length) {
    document.getElementById(targetId).innerHTML =
      "<p class='text-slate-400'>No data available</p>";
    return;
  }

  const top20 = [...data].sort((a,b)=>b.b3-a.b3).slice(0,20);

  let bestScore = -Infinity;
  let best = null;

  function permute(arr, l, res) {
    if (l === arr.length) return res.push(arr.slice());
    for (let i=l;i<arr.length;i++){
      [arr[l],arr[i]]=[arr[i],arr[l]];
      permute(arr,l+1,res);
      [arr[l],arr[i]]=[arr[i],arr[l]];
    }
  }

  const perms = [];
  permute(MULTS.slice(),0,perms);

  function backtrack(start, lineup) {
    if (lineup.length === 5) {
      perms.forEach(m=>{
        let score = lineup.reduce((s,p,i)=>s+p.projection*(m[i]+p.boost),0);
        if (score>bestScore){
          bestScore=score;
          best={lineup:[...lineup],mults:[...m]};
        }
      });
      return;
    }
    for (let i=start;i<top20.length;i++){
      backtrack(i+1,[...lineup,top20[i]]);
    }
  }

  backtrack(0,[]);

  let html = `<table class="w-full bg-white dark:bg-slate-800 rounded-lg">
    <thead class="bg-slate-200 dark:bg-slate-700">
      <tr>
        <th class="p-2">Player</th>
        <th class="p-2 text-right">Proj</th>
        <th class="p-2 text-right">Boost</th>
        <th class="p-2 text-right">Mult</th>
        <th class="p-2 text-right">Score</th>
      </tr>
    </thead><tbody>`;

  let total = 0;

  best.lineup
    .map((p,i)=>({
      p,
      m: best.mults[i],
      s: p.projection*(best.mults[i]+p.boost)
    }))
    .sort((a,b)=>b.m-a.m)
    .forEach(r=>{
      total+=r.s;
      html+=`<tr class="border-t dark:border-slate-700">
        <td class="p-2">${r.p.player}</td>
        <td class="p-2 text-right">${r.p.projection.toFixed(2)}</td>
        <td class="p-2 text-right text-green-400">${r.p.boost.toFixed(1)}</td>
        <td class="p-2 text-right">${r.m.toFixed(1)}</td>
        <td class="p-2 text-right font-bold">${r.s.toFixed(2)}</td>
      </tr>`;
    });

  html+=`</tbody>
    <tfoot>
      <tr class="font-bold border-t dark:border-slate-700">
        <td class="p-2">Total</td>
        <td colspan="4" class="p-2 text-right">${total.toFixed(2)}</td>
      </tr>
    </tfoot></table>`;

  document.getElementById(targetId).innerHTML = html;
}

/* ================= THEME ================= */
function toggleTheme(){
  document.documentElement.classList.toggle("dark");
}

/* ================= MENU STYLE ================= */
document.querySelectorAll(".menu-btn").forEach(b=>{
  b.className="px-3 py-2 rounded bg-slate-300 dark:bg-slate-700 hover:bg-slate-400";
});

loadData();
</script>

</body>
</html>
